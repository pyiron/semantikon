# Specs

## semantikon representation

#### Workflow

The semantikon representation of a workflow is a **nested dictionary** with the following entries on the top level (which is the main workflow level):

- `label` (required): Name of the workflow
- `inputs` (required): Input arguments and their metadata (see below)
- `outputs` (required): Output arguments and their metadata (see below)
- `nodes` (required): Atomic nodes or nested workflows (see below)
- `edges` (required): Edge connections of the nodes (see below)
- `type` (required): It must be "Workflow" (otherwise "Function" for the atomic nodes)
- `function` (optional): The underlying python function and its metadata (see below)

#### Inputs Outputs

The input and output arguments must be given by a dictionary whose key is the argument name in the case of the input, and a label in the case of the output. The value must be given by a dictionary, which can in principle contain anything (or nothing). Following arguments can be currently understood by `semantikon` (all optional):

- `value`: Literal value of the argument
- `dtype`: Data type; currently this has no meaning for `semantikon` except for data classes
- `uri`: URIRef of what the argument represents (must be a class)
- `triples`: A double, a triple or a list/tuple of doubles or triples. See below for the syntax
- `restrictions`: owl-type restrictions. See below for the syntax
- `units`: QUDT URI or str that can be understood by pint (and will be later translated to pint URI)
- `derived_from`: To indicate that (typically) an output is derived from an input. For example painting a car where the output is basically the same car as the input with a different color.

#### Atomic node
An atomic node is represented by a dictionary whose key represents the name of the node and the value is given by a dictionary containing the following arguments:

- `inputs` (required): Input arguments and their metadata (see above)
- `outputs` (required): Output arguments and their metadata (see above)
- `type` (required): "Function" for an atomic node
- `function` (required): Underlying python function (note: **required** for an atomic node)

#### Edges

Edges are represented by list of lists containing the source node and the target node, which is given in the format `io.arg_name` (for the workflow inputs or outputs) or `atomic_node_name.io.arg_name`.

#### Function

`function` is the function object itself or a dictionary with the following arguments:

- `module` (required): Path to the function (as given by `fnc.__module__` in python)
- `qualname` (required): Name of the function (as given by `fnc.__qualname__` in python)
- `version` (required): Python version. As long as it is given, it does not have to follow a certain format
- `docstring` (optional): Docstring
- `hash` (optional): Hash value (or an identifier)

## Knowledge graph

A knowledge graph generated by `semantikon` is based on the [PMD Core Ontology](https://materialdigital.github.io/core-ontology/) (PMDco) which is derived from the [Basic Formal Ontology](https://basic-formal-ontology.org) (BFO). `semantikon` exports a knowledge graph in the `rdflib.Graph` format, which contains the A-box (execution graph), T-box (recipe) or both of them. In particular, each workflow recipe dynamically defines a T-box. Each class in the T-box has the namespace `http://pyiron.org/ontology` (subject to change). The knowledge graph contains the following nodes:

- **Process** (`http://purl.obolibrary.org/obo/BFO_0000015`): A workflow node, applied to both workflows and atomic nodes
- **Input assignment** (`https://w3id.org/pmd/co/PMD_0000066`): Input port of a node, i.e. input argument in the sense of python. This node only specifies which argument, but does not contain any metadata (such as value, datatype etc.)
- **Output assignment** (`https://w3id.org/pmd/co/PMD_0000066`): Analogous to input assignment
- **Value specification** (`http://purl.obolibrary.org/obo/OBI_0001933`): Data node attached to an input and/or output assignment. This node contains all the metadata attached to the input and output ports, such as value, URI, ontological triples, restrictions etc.

Here the corresponding predicates:

- **has_part** (`http://purl.obolibrary.org/obo/BFO_0000051`): **process** to **input** and **output assignment**
- **has_participant** (`http://purl.obolibrary.org/obo/RO_0000057`): **input** and **output assignment** to

Diagramatically, the nodes and predicates given above are connected as follows:
```mermaid
graph LR
process_1[Process 1] -- has_part --> ia[Input assignment] -- has_participant --> vs[Value specification]
process_2[Process 2] -- has_part --> oa[Output assignment] -- has_participant --> vs
```

In addition, the order of the process is denoted by **precedes** (`http://purl.obolibrary.org/obo/BFO_0000063`).
